This is the CHANGELOG for amavisd-milter.

20061203:
	Added info about user authentication to synthesized received header.
	Format of synthesized received header is now:

	Received: from <hello> (<rdns> [<ip>]) (authenticated bits=<bits>)
		by <hostname> (<rdns> [<ip>])
		with <protocol> (authenticated as <user>) id <qid>;
		<date>
		(envelope-from <sender>)

20061113:
	Limited support for legacy sendmail 8.12:
	- amavisd-milter don't call smfi_progress when wait for amavisd-new
	  communication socket.
	- amavisd-milter use smfi_addheader insted of smfi_insheader for
	  insheader and addheader AM.PDP response commands. This work well
	  with amavisd-new 2.4.3 or newer. Older versions are affected with
	  bug fixed on 20060714.

20061017:
	Implemented AM.PDP request attribute protocol_name.

	amavisd-milter adds Received header for the current connection to
	the mail file as the first line because without the most recent
	Received header, Spamassassin reports lots of false hits on rules
	checking where the message was received from.
	Thanks to: Jo Rhett <jrhett@netconsonance.com>

	NOTE: Please add these line to your sendmail.mc:

	define(`confMILTER_MACROS_ENVFROM', confMILTER_MACROS_ENVFROM`, r, b')


20061008:
	amavisd-milter-1.2.0

	Improved amavisd connection locking.  When amavisd connection is closed,
	lock is removed immediately.

20061004:
	Implemented AM.PDP protocol version 2.  New response attributes
	are version_server, insheader and quarantine.

	Tru64 portability fix: don't use variadic macros.

20060714:
	Fixed bug with addheader: amavisd-new assume that header is added
	to the end of headers but sendmail insert it before first occurence
	of the header with same name.
	Submitted by: Krzysztof Oledzki <ole@ans.pl>

20060616:
	Amavisd communication buffer is now dynamically allocated.
	MAXAMABUF is maximum buffer length, AMABUFCHUNK is initial length
	and reallocation step.  Buffer is allocated for every connection.

	Tru64 portability fix: replace missing daemon(8) function.

20060414:
	amavisd-milter-1.1.2

	MAXAMABUF is increased from 2048 to 65536 because it must be greater
	then confMAX_HEADERS_LENGTH which is usually set to 32768. If mail
	header is longer than MAXAMABUF, mail is permanently rejected with
	temporary fail return code and will never reach the recipents.

	Added new configure option --with-sendmail=<DIR> which change base
	directory in which are placed libmilter header files and library
	(e.q. /usr/local on FreeBSD when you using sendmail from ports).

20060125:
	amavisd-milter-1.1.1

	Portability release. amavisd-milter-1.1 now can be compiled on
	FreeBSD, NetBSD, OpenBSD, Linux and Solaris.  Please report 
	success or problems on the users mailing list.

20060125:
	Linux and Solaris portability fix: sem_t is declared as pointer on
	*BSD but as structure on Linux and Solaris.

	Solaris portability fix: search sem_init in librt.

	Solaris portability fix: replace missing fts.h API.

20060124:
	amavisd-milter-1.1.0

	New features:
	- amavisd-milter can limit number of concurrent connections
	  to amavisd-new
	- amavisd-milter is responsible to remove message work
	  directory

20060124:
	README is now generated from amavisd-milter(8) manual page.

	Remove all files and directories in work directory because
	amavisd-new sometimes don't do it (e.q. when antivirus fail).

20060123:
	Limit maximum concurrent connections to amavisd:

	    amavisd-milter -m 4 -M 600

	means that there is limit to maximum 4 concurrent connections to
	amavisd and wait maximum 10 minutes (10*60 sec) for connection to
	amavisd.  When connection isn't available, amavisd-milter sleep for
	1 sec.  Every minute of waiting is sendmail triggered via
	smfi_progress.  When time limit run out then amvisd-milter return
	temporary fail.

20060113:
	amavisd-milter-1.0.4

	Bugfix release.  Added manual page amavisd-milter(8).

	INCOMPATIBILITY with 1.0.3 and previous versions:

	Default working directory was changed from /var/amavis/tmp
	to /var/amavis to accordance with amavisd-new $helpers_home
	default value.  To go back to the previous behaviour run
	amavisd-milter with option -w /var/amavis/tmp

20060109:
	When stopping amavisd-new one (maybe not always just one) of milter
	threads amavisd-milter start to eat up a cpu time.
	Submitted by: Grzegorz Piszczek <grzegorz@piszczek.name>

	Fixed bug in mlfi_close(): amavisd-milter dies randomly due to
	segmentation fault.
	Submitted by: Grzegorz Piszczek <grzegorz@piszczek.name>

20051225:
	Added amavisd-milter(8) manual page.  README and website are
	synchronized with this manual page.

	Changed default working directory to /var/amavis (default value
	for amavisd-new helpers home directory).

20051204:
	Some users reports problem with ENOMEM in amavis_response().
	Consequently MAXAMABUF is increased from 1024 to 2048, amavis_request()
	and amavis_response() returns EOVERFLOW when buffer size isn't enough
	and truncated response is logged when debug level is >= 3.

20051202:
	Fixed default path to pidfile in README and website.
	Submitted by: Jerzy Sakol <jerzy.sakol@commgraf.pl>

20050829:
	Added amavisd-new configuration section to README.

20050701:
	amavisd-milter-1.0.3

	Bugfix release.  Properly set amavisd connection timeout.

20050701:
	Set amavisd_timeout instead of mlfi_timeout for -T option.
	Submitted by: Mr.Sompis Junsui <sompis.j@cdg.co.th>

20050701:
	Unlink old pid file on start.

20050605:
	amavisd-milter-1.0.2

	Bugix release.  Fix memory leak in mlfi_cleanup.

20050529:
	amavisd-milter-1.0.1

	Portability release.  Now can be compiled on Debian 3.0, Fedora FC2 and
	FC3, OpenBSD 3.4 and Solaris 9.  Tested on Sourceforge compile farm.
	Please report success or problems on the users mailing list:

	http://lists.sourceforge.net/lists/listinfo/amavisd-milter-users

20050522:
	Define EILSEQ on systems without it.

20050520:
	mkdtemp(3) compatibility function.

20050512:
	Initial version of README.

20050512:
	Better portability with autoconf macros from
	http://ac-archive.sourceforge.net/

20050510:
	strlcpy(3) compatibility function.

20050511:
	amavisd-milter-1.0.0

	First public release.  Fully tested on FreeBSD 5.3.


$Id: CHANGES,v 1.39 2006/12/03 18:39:02 reho Exp $
